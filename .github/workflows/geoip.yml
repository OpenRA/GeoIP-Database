name: GeoIP

on:
  schedule:
    - cron: '28 13 7 * *'
  workflow_dispatch:

jobs:
  build:
    name: Cache GeoIP database
    runs-on: ubuntu-20.04

    steps:
     - name: Clone Repository
       uses: actions/checkout@v2

     - name: Fetch GeoIP from ip2location.
       run: ./fetch-geoip.sh

     - name: Create Release
       id: create_release
       uses: actions/create-release@v1
       env:
          GITHUB_TOKEN: ${{ secrets.GEOIP_TOKEN }}
       with:
          tag_name: monthly
          draft: false
          prerelease: false

     - name: Upload Release Asset
       id: upload-release-asset
       uses: actions/upload-release-asset@v1
       env:
         GITHUB_TOKEN: ${{ secrets.GEOIP_TOKEN }}
       with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./IP2LOCATION-LITE-DB1.IPV6.BIN.ZIP
          asset_name: IP2LOCATION-LITE-DB1.IPV6.BIN.ZIP
          asset_content_type: application/zip
